<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset=UTF-8"utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>
            Laravel Administrator Documentation                            : Relationships                    </title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="../css/style.css">
        <script src="../js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="javascript:if(confirm('http://browsehappy.com/  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://browsehappy.com/'">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div class="wrapper">
            <header>
                
                <h1>Laravel Administrator Documentation</h1>
                <div id="donateContainer">
                    <form action="javascript:if(confirm('http://administrator.frozennode.com/charge  \n\n该文件无法用 Teleport Ultra 下载, 因为 服务器报告该文件的请求方法不允许使用。  \n\n你想在服务器上打开它?'))window.location='http://administrator.frozennode.com/charge'">
                        <button id="donateButton" class="stripe-button-el">
                            <span style="display: block; min-height: 30px;">Donate</span>
                        </button>
                    </form>
                </div>
            </header>
            <aside class="sidebar">
                	<ul>
<li>Overview

<ul>
<li><a href="introduction.htm">Introduction</a></li>
<li><a href="contributing.htm">Contributing</a></li>
<li><a href="style-guide.htm">Style Guide</a></li>
<li><a href="license.htm">License</a></li>
</ul></li>
<li>Getting Started

<ul>
<li><a href="installation.htm">Installation</a></li>
<li><a href="configuration.htm">Configuration</a></li>
<li><a href="model-configuration.htm">Model Configuration</a></li>
<li><a href="settings-configuration.htm">Settings Configuration</a></li>
<li><a href="validation.htm">Validation</a></li>
<li><a href="localization.htm">Localization</a></li>
<li><a href="tutorials.htm">Tutorials</a></li>
</ul></li>
<li>Custom Actions

<ul>
<li><a href="actions.htm">Overview</a></li>
</ul></li>
<li>Columns

<ul>
<li><a href="columns.htm">Overview</a></li>
<li><a href="relationship-columns.htm">Relationships</a></li>
</ul></li>
<li>Fields

<ul>
<li><a href="fields.htm">Overview</a></li>
</ul></li>
<li>Field Types

<ul>
<li><a href="field-type-key.htm">Key</a></li>
<li><a href="field-type-text.htm">Text</a></li>
<li><a href="field-type-password.htm">Password</a></li>
<li><a href="field-type-textarea.htm">TextArea</a></li>
<li><a href="field-type-wysiwyg.htm">WYSIWYG</a></li>
<li><a href="field-type-markdown.htm">Markdown</a></li>
<li><a href="field-type-relationship.htm">Relationship</a></li>
<li><a href="field-type-number.htm">Number</a></li>
<li><a href="field-type-bool.htm">Bool</a></li>
<li><a href="field-type-enum.htm">Enum</a></li>
<li><a href="field-type-date.htm">Date</a></li>
<li><a href="field-type-time.htm">Time</a></li>
<li><a href="field-type-datetime.htm">Datetime</a></li>
<li><a href="field-type-file.htm">File</a></li>
<li><a href="field-type-image.htm">Image</a></li>
<li><a href="field-type-color.htm">Color</a></li>
</ul></li>
</ul>
            </aside>
            <section class="content">
                	<h1>Relationship Columns</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#setting-up-the-eloquent-relationship">Setting Up the Eloquent Relationship</a></li>
<li><a href="#simple-select">Simple Select</a></li>
<li><a href="#more-complex-selects">More Complex Selects</a></li>
<li><a href="#nested-relationships">Nested Relationships</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2>Introduction</h2>

<blockquote>
  <p><strong>Note</strong>: This article is just about relationship columns. For a more in-depth look at all column options, check out <a href="columns.htm">the columns docs</a></p>
</blockquote>

<p>In any moderately complex database, a table might have columns that represent an ID on another table. Most of the time it's fairly useless to display this ID to an admin user because numbers mean more to a computer than to a human. Alternatively, a relationship may not be represented on a model's table at all, but instead on a pivot table that connects two tables, or as a column on another model's table.</p>

<p>If you want to display related columns, you can provide a <code>relationship</code> option. The value of this option has to be <em>the name of the Eloquent relationshp on your model</em>. In addition to this, you need to provide a <code>select</code> option that Administrator will use to grab values from the relationship table.</p>

<p><a name="setting-up-the-eloquent-relationship"></a></p>

<h2>Setting Up the Eloquent Relationship</h2>

<p>The <a href="javascript:if(confirm('http://laravel.com/docs/eloquent  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://laravel.com/docs/eloquent#relationships'">Eloquent relationship</a> should be set up normally using the relationship method. This would look something like this:</p>

<pre><code>class User extends Eloquent {

    public function phone()
    {
        return $this-&gt;hasOne('Phone');
    }
}
</code></pre>

<p>In this case, the relationship "name" that we will want to reference is <code>phone</code> (the name of the method). Another example might look like:</p>

<pre><code>class Director extends Eloquent {

    public function films()
    {
        return $this-&gt;belongsToMany('Film');
    }
}
</code></pre>

<p>In this case, the relationship "name" that we will want to reference is <code>films</code>.</p>

<p>Administrator will respect any conditional filters you have on your relationships. This is especially relevant for <code>hasMany</code> or <code>belongsToMany</code> relationships. For example, if you set up your relationship like this:</p>

<pre><code>public function alerts()
{
    return $this-&gt;hasMany('Alert')-&gt;whereNotified(false); //only gets unnotified alerts
}
</code></pre>

<p>And you use a select to count the number of alerts, it will only count those where the <code>notified</code> column is <code>0</code>.</p>

<p><a name="simple-select"></a></p>

<h2>Simple Select</h2>

<p>A simple <code>select</code> statement would be used when the data that you're joining is necessarily just one row long. This happens when the relationship is defined as a <code>belongsTo</code> or <code>hasOne</code> relationship. So let's pretend that you have a <code>hats</code> table represented by the <code>Hat</code> model. Each hat is owned by a single <code>User</code>, so there is a <code>user_id</code> column on the <code>hats</code> table. If you are displaying the <code>Hat</code> model in Administrator, you could display the hat's owner's email address in a column by doing this:</p>

<pre><code>'user_email' =&gt; array(
    'title' =&gt; "Owner's Email",
    'relationship' =&gt; 'user', //this is the name of the Eloquent relationship method!
    'select' =&gt; "(:table).email",
)
</code></pre>

<p>If you want to display the user's first and last name, you could do this:</p>

<pre><code>'user_name' =&gt; array(
    'title' =&gt; "Owner's Name",
    'relationship' =&gt; 'user', //this is the name of the Eloquent relationship method!
    'select' =&gt; "CONCAT((:table).first_name, ' ', (:table).last_name)",
)
</code></pre>

<p><a name="more-complex-selects"></a></p>

<h2>More Complex Selects</h2>

<p>If want to show data from a <code>hasMany</code> or <code>belongsToMany</code> relationship, you may want to provide a grouping function in your <code>select</code> statement. If you have a <code>Director</code> model and you want to count the number of films he's been involved in, you could do something like this:</p>

<pre><code>'num_films' =&gt; array(
    'title' =&gt; '# Films',
    'relationship' =&gt; 'films', //this is the name of the Eloquent relationship method!
    'select' =&gt; "COUNT((:table).id)",
)
</code></pre>

<p>If you are in your <code>Film</code> model and you want to show a formatted total of all the box office revenue, you could do this:</p>

<pre><code>'box_office' =&gt; array(
    'title' =&gt; 'Box Office',
    'relationship' =&gt; 'boxOffice', //this is the name of the Eloquent relationship method!
    'select' =&gt; "CONCAT('$', FORMAT(SUM((:table).revenue), 2))",
)
</code></pre>

<p>As long as you provide a valid SQL SELECT statement into the <code>select</code> option, you have a lot of power to display your columns however you like.</p>

<p><a name="nested-relationships"></a></p>

<h2>Nested Relationships</h2>

<p>Sometimes you might want to display a column value of a distantly-related model. In particular, when you have a series of <code>belongsTo</code> relationships. Imagine, for example, that you have a <code>cart</code> table. On it you have <code>inventory_id</code>, which points to the <code>inventory</code> table. The <code>inventory</code> table has <code>product_id</code>, which points to the <code>products</code> table. Your models migth look like:</p>

<h3>Cart Model</h3>

<pre><code>public function inventory()
{
    return $this-&gt;belongsTo('Inventory');
}
</code></pre>

<h3>Inventory Model</h3>

<pre><code>public function product()
{
    return $this-&gt;belongsTo('Product');
}
</code></pre>

<p>Each product has a name and we want to select it for rows in our <code>cart</code> admin. In order to do this, you can use the dot syntax that <a href="javascript:if(confirm('http://laravel.com/docs/eloquent  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://laravel.com/docs/eloquent#eager-loading'">Eloquent uses when eager loading nested relationships</a>.</p>

<pre><code>'product_name' =&gt; array(
    'title' =&gt; 'Product Name',
    'relationship' =&gt; 'inventory.product',
    'select' =&gt; '(:table).name', //would select products.name
)
</code></pre>

<p>There is no limit to this nesting, so if you wanted to get the product's category name, you could do:</p>

<pre><code>'category_name' =&gt; array(
    'title' =&gt; 'Category Name',
    'relationship' =&gt; 'inventory.product.category',
    'select' =&gt; '(:table).name', //would select categories.name
)
</code></pre>
                <nav>
                                    <a href="columns.htm">鈫?Overview</a> |
                                                    <a href="fields.htm">Overview 鈫?/a>
                                </nav>
                <footer>
                    <p><a href="javascript:if(confirm('http://github.com/daylerees/docs-reader  \n\n该文件无法用 Teleport Ultra 下载, 因为 它是一个域或路径外部被设置为它的启始地址的地址。  \n\n你想在服务器上打开它?'))window.location='http://github.com/daylerees/docs-reader'">Dayle Rees</a>.</p>
                </footer>
            </section>
            <div class="clearfix"></div>
        </div>

        <script src="../../ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="../js/vendor/jquery-1.8.2.min.js"/*tpa=http://administrator.frozennode.com/js/vendor/jquery-1.8.2.min.js*/><\/script>')</script>
        <script src="../../checkout.stripe.com/v2/checkout.js"></script>
        <script src="../js/vendor/prettify.js"></script>
        <script src="../js/plugins.js"></script>
        <script src="../js/main.js"></script>

        <script type="text/javascript">

          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-37898177-1']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www/') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();

        </script>
    </body>
</html>